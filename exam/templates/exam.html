{% extends "base.html" %}
{% block content %}

<!-- ===== STUDENT NAME BANNER ===== -->
<div id="studentBanner"
     style="background:#C9A227;padding:10px;color:black;font-weight:bold;display:none;">
</div>

<!-- ===== TIMER ===== -->
<div id="timerBox" style="font-size:18px;color:red;font-weight:bold;text-align:right;">
‚è≥ Time Remaining: <span id="timeDisplay"></span>
</div>

<h2>English Grammar & Logic Examination</h2>

<form method="POST" id="examForm">
{% csrf_token %}

<label><b>Student Name:</b></label><br>
<input type="text" name="student_name" required><br><br>

<label><b>Email:</b></label><br>
<input type="email" name="student_email" required><br><br>

{% for no, q in questions.items %}
    <h3>{{ no }}. {{ q.q }}</h3>

    {% for key, value in q.options.items %}
        <input type="radio" name="{{ no }}" value="{{ key }}" required>
        {{ key }}) {{ value }}<br>
    {% endfor %}
{% endfor %}

<br>
<button type="submit" id="submitBtn">Submit Exam</button>
</form>


<!-- ================= TIMER SCRIPT ================= -->
<script>
// ===== 90 MINUTE TIMER =====
let timeLeft = 90 * 60;   // 90 minutes
const display = document.getElementById("timeDisplay");
const form = document.getElementById("examForm");
const submitBtn = document.getElementById("submitBtn");

function format(seconds){
    let m = Math.floor(seconds / 60);
    let s = seconds % 60;
    return m + ":" + (s < 10 ? "0" + s : s);
}

display.innerHTML = format(timeLeft);

let countdown = setInterval(() => {
    timeLeft--;
    display.innerHTML = format(timeLeft);

    if(timeLeft <= 0){
        clearInterval(countdown);
        alert("Time is up! Your exam is being submitted.");
        submitBtn.disabled = true;
        form.submit();
    }
}, 1000);


// ===== SHOW STUDENT NAME AT TOP =====
function showName(){
  let name = document.querySelector("input[name='student_name']").value;
  if(name){
      document.getElementById("studentBanner").style.display="block";
      document.getElementById("studentBanner").innerHTML = "Candidate: " + name;
  }
}
document.querySelector("input[name='student_name']").addEventListener("keyup", showName);


// ===== PREVENT MULTIPLE SUBMISSIONS =====
let submitted = false;

form.addEventListener("submit", function(){
    if(submitted){
        alert("Exam already submitted. Please wait...");
        return false;
    }
    submitted = true;
    submitBtn.disabled = true;
    submitBtn.innerHTML = "Submitting...";
});
</script>

{% endblock %}
